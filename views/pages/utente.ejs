<!doctype html>
<html lang="it">
<%- include('../partials/header') %>
<body class="d-flex flex-column min-vh-100">
 <%- include('../partials/navbar') %>
<main class="container my-5">
    <div class="row">
        <div class="col-md-3">
            <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                <a href="#v-pills-dati" class="nav-link text-start <%= currentSection === 'dati' ? 'active' : '' %>" data-bs-toggle="pill">
                    <i class="bi bi-person-circle me-2"></i>I miei Dati
                </a>
                <a href="#v-pills-ordini" class="nav-link text-start <%= currentSection === 'ordini' ? 'active' : '' %>" data-bs-toggle="pill">
                    <i class="bi bi-box-seam me-2"></i>Storico Ordini
                </a>
                <a href="#v-pills-indirizzi" class="nav-link text-start <%= currentSection === 'indirizzi' ? 'active' : '' %>" data-bs-toggle="pill">
                    <i class="bi bi-geo-alt me-2"></i>Indirizzi
                </a>
                <% if (user.tipo_account === 'venditore') { %>
                <a href="#v-pills-prodotti" class="nav-link text-start <%= currentSection === 'prodotti' ? 'active' : '' %>" data-bs-toggle="pill">
                    <i class="bi bi-tag me-2"></i>I miei Prodotti
                </a>
                <% } %>
                <% if (user.tipo_account === 'venditore') { %>
                    <a href="#v-pills-statistiche" class="nav-link text-start <%= currentSection === 'statistiche' ? 'active' : '' %>" data-bs-toggle="pill">
                        <i class="bi bi-bar-chart-line me-2"></i>Statistiche Venditore
                    </a>
                <% } %>
            </div>
        </div>
        <div class="col-md-9">
            <div class="tab-content" id="v-pills-tabContent">
                <div class="tab-pane fade <%= currentSection === 'dati' ? 'show active' : '' %>" id="v-pills-dati" role="tabpanel">
                    <h3>I Miei Dati</h3>
                    <p>Gestisci le tue informazioni personali.</p>
                    <div class="card">
                        <div class="card-body">
                            <form action="/utente/dati/aggiorna" method="POST">
                                <div class="mb-3">
                                    <label for="userName" class="form-label">Nome</label>
                                    <input type="text" class="form-control" id="userName" name="nome" value="<%= user.nome %>">
                                </div>
                                <div class="mb-3">
                                    <label for="userSurname" class="form-label">Cognome</label>
                                    <input type="text" class="form-control" id="userSurname" name="cognome" value="<%= user.cognome %>">
                                </div>
                                <div class="mb-3">
                                    <label for="username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="username" name="username" value="<%= user.username %>">
                                </div>
                                <div class="mb-3">
                                    <label for="userEmail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="userEmail" name="email" value="<%= user.email %>" disabled>
                                </div>
                                <div class="mb-3">
                                    <label for="userDataNascita" class="form-label">Data di Nascita</label>
                                    <input type="date" class="form-control" id="userDataNascita" name="data_nascita" value="<%= user.data_nascita ? new Date(user.data_nascita).toISOString().split('T')[0] : '' %>">
                                </div>
                                <button type="submit" class="btn btn-primary">Salva Modifiche</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade <%= currentSection === 'ordini' ? 'show active' : '' %>" id="v-pills-ordini" role="tabpanel">
                    <h3>Storico Ordini</h3>
                    <p>Visualizza tutti gli acquisti che hai effettuato.</p>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID Ordine</th>
                                <th>Data</th>
                                <th>Totale</th>
                                <th>Stato</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (ordini && ordini.length > 0) { %>
                                <% ordini.forEach(ordine => { %>
                                    <tr>
                                        <td>#<%= ordine.id %></td>
                                        <td><%= new Date(ordine.data_ordine).toLocaleDateString('it-IT') %></td>
                                        <td>€ <%= ordine.totale.toFixed(2) %></td>
                                        <td><span class="badge bg-success"><%= ordine.stato %></span></td>
                                    </tr>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="4" class="text-center text-muted">Non hai ancora effettuato nessun ordine.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane fade <%= currentSection === 'indirizzi' ? 'show active' : '' %>" id="v-pills-indirizzi" role="tabpanel">
                    <h3>I Miei Indirizzi</h3>
                    <p>Gestisci i tuoi indirizzi di spedizione e fatturazione.</p>
                    <div class="row">
                        <% if (indirizzi && indirizzi.length > 0) { %>
                            <% indirizzi.forEach(indirizzo => { %>
                                <div class="col-md-6 mb-3">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">Indirizzo</h5>
                                            <p class="card-text">
                                                <%= indirizzo.indirizzo %>, <%= indirizzo.citta %><br>
                                                <%= indirizzo.cap %>
                                            </p>
                                            <a href="#" class="btn btn-sm btn-outline-primary">Modifica</a>
                                            <a href="#" class="btn btn-sm btn-outline-danger">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        <% } else { %>
                            <div class="col">
                                <p class="text-center text-muted">Non hai ancora aggiunto nessun indirizzo.</p>
                            </div>
                        <% } %>
                    </div>
                    <button class="btn btn-primary mt-3">Aggiungi un nuovo indirizzo</button>
                </div>
                <div class="tab-pane fade <%= currentSection === 'prodotti' ? 'show active' : '' %>" id="v-pills-prodotti" role="tabpanel">
                    <h3>I Miei Prodotti</h3>
                    <p>Gestisci i prodotti che hai messo in vendita.</p>
                    <div class="list-group">
                    <% if (prodotti && prodotti.length > 0) { %>
                        <% prodotti.forEach(prodotto => { %>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1"><%= prodotto.nome %></h5>
                                    <small>
                                        Prezzo: € <%= typeof prodotto.prezzo === 'number' ? prodotto.prezzo.toFixed(2) : 'N/D' %>
                                    </small>
                                </div>
                                <div>
                                    <a href="/products/modifica/<%= prodotto.id %>" class="btn btn-sm btn-outline-primary">Modifica</a>
                                    <form action="/utente/prodotti/elimina/<%= prodotto.id %>" method="POST" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">Elimina</button>
                                    </form>
                                </div>
                            </div>
                        <% }) %>
                    <% } else { %>
                        <p class="text-center text-muted">Non hai nessun prodotto in vendita.</p>
                    <% } %>
                    </div>
                </div>
                <% if (user.tipo_account === 'venditore') { %>
                <div class="tab-pane fade <%= currentSection === 'statistiche' ? 'show active' : '' %>" id="v-pills-statistiche" role="tabpanel">
                    <h3>Statistiche Venditore</h3>
                    <p>Visualizza le tue statistiche di vendita.</p>
                    <!-- Statistiche venditore qui -->
                </div>
                <% } %>
            </div>
        </div>
    </div>
</main>
<%- include('../partials/footer') %>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<!-- JS rimane invariato -->
</body>
</html>
